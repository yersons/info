<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora Pre Espol</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f7f7f8; --fg:#1f2328; --muted:#6b7280; --card:#ffffff; --stroke:#e5e7eb;
      --primary:#0f766e; --primary-press:#0b5b56; --ok:#16a34a; --bad:#dc2626;
      --card-soft:#f0f2f5;
    }
    body.dark-mode{
      --bg:#0f1115; --fg:#e5e7eb; --muted:#9aa4af; --card:#151922; --stroke:#2b3240;
      --primary:#0ea5a5; --primary-press:#098b8b; --ok:#22c55e; --bad:#f87171;
      --card-soft:#0e131b;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      transition:background .25s,color .25s;
    }

    header{
      position:sticky; top:0; z-index:10;
      display:flex; justify-content:flex-end; align-items:center;
      gap:12px; padding:12px 20px; background:var(--card);
      border-bottom:1px solid var(--stroke);
    }
    .toggle{border:1px solid var(--stroke); background:var(--card-soft); color:var(--fg)}
    .btn{padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:600}
    .btn:hover{filter:brightness(0.98)}

    .wrap{max-width:820px; margin:36px auto; padding:0 18px}
    h1{margin:0 0 20px; text-align:center; font-size:28px; letter-spacing:.2px}

    .card{
      background:var(--card); border:1px solid var(--stroke);
      border-radius:16px; padding:20px; box-shadow:0 6px 16px rgba(0,0,0,.05);
    }
    .grid{
      display:grid; gap:16px;
      grid-template-columns:repeat(auto-fit, minmax(240px, 1fr));
    }
    .field{display:flex; flex-direction:column; gap:6px}
    label{font-weight:600}
    .hint{font-size:12px; color:var(--muted)}
    input{
      width:100%; padding:12px 12px; border-radius:10px;
      border:1px solid var(--stroke); background:transparent; color:var(--fg);
      font-size:16px;
    }
    .actions{display:flex; justify-content:center; margin-top:16px}
    .primary{background:var(--primary); color:#fff}
    .primary:active{background:var(--primary-press)}

    .result{
      margin-top:18px; display:grid; gap:10px; justify-items:center; text-align:center;
    }
    .final{font-size:42px; font-weight:800; letter-spacing:.5px}
    .state{font-size:18px; font-weight:700}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    .subtle{font-size:14px; color:var(--muted)}
    .pill{
      margin-top:4px; padding:6px 10px; border:1px solid var(--stroke);
      border-radius:999px; font-size:12px; color:var(--muted); background:var(--card-soft);
    }
    .need{
      font-size:15px; font-weight:600; margin-top:6px;
    }
  </style>
</head>
<body class="light-mode">
  <header>
    <button id="toggleTheme" class="btn toggle">Modo oscuro</button>
  </header>

  <div class="wrap">
    <h1>Calculadora Pre Espol</h1>

    <div class="card">
      <div class="grid">
        <div class="field">
          <label for="leccion">Lección general (20%)</label>
          <input type="number" id="leccion" min="0" max="100" step="1" placeholder="0–100" />
        </div>

        <div class="field">
          <label for="examen">Examen final (50%)</label>
          <input type="number" id="examen" min="0" max="100" step="1" placeholder="0–100" />
        </div>

        <div class="field">
          <label for="mejora">Examen de mejoramiento (opcional)</label>
          <input type="number" id="mejora" min="0" max="100" step="1" placeholder="0–100" />
        </div>

        <div class="field">
          <label for="pruebas">Pruebas de salida (10%)</label>
          <input type="number" id="pruebas" min="0" max="100" step="1" placeholder="0–100" />
        </div>

        <div class="field">
          <label for="controles">Controles de lectura (5%)</label>
          <input type="number" id="controles" min="0" max="100" step="1" placeholder="0–100" />
        </div>

        <div class="field">
          <label for="talleres">Talleres grupales (5%)</label>
          <input type="number" id="talleres" min="0" max="100" step="1" placeholder="0–100" />
        </div>

        <div class="field">
          <label for="tareas">Tareas (10%)</label>
          <input type="number" id="tareas" min="0" max="100" step="1" placeholder="0–100" />
        </div>
      </div>

      <div class="actions">
        <button id="calcular" class="btn primary">Calcular</button>
      </div>

      <div class="result">
        <div class="final" id="resultado">0.0</div>
        <div class="state" id="estado">–</div>
        <div class="subtle">
          Componente 70%: <span id="sub70">0.0 / 70</span> ·
          Componente 30%: <span id="sub30">0.0 / 30</span>
        </div>
        <div class="pill">Usando: <span id="origen">Examen final</span></div>
        <div id="necesita" class="need"></div>
      </div>
    </div>
  </div>

  <script>
    const clamp0100 = v => Math.min(100, Math.max(0, Number.isFinite(v) ? v : 0));
    const $ = id => document.getElementById(id);

    const leccion = $("leccion"), examen = $("examen"), mejora = $("mejora"),
          pruebas = $("pruebas"), controles = $("controles"), talleres = $("talleres"), tareas = $("tareas");

    const resultado = $("resultado"), estado = $("estado"),
          sub70 = $("sub70"), sub30 = $("sub30"),
          origen = $("origen"), necesita = $("necesita");

    function calcularNota(){
      const nLeccion = clamp0100(parseFloat(leccion.value));
      const nExamen  = clamp0100(parseFloat(examen.value));
      const nMejora  = clamp0100(parseFloat(mejora.value));
      const nPruebas = clamp0100(parseFloat(pruebas.value));
      const nControles = clamp0100(parseFloat(controles.value));
      const nTalleres = clamp0100(parseFloat(talleres.value));
      const nTareas = clamp0100(parseFloat(tareas.value));

      // Sub 30 fijo
      const comp30 = nPruebas*0.10 + nControles*0.05 + nTalleres*0.05 + nTareas*0.10;

      // Comparar final vs mejoramiento
      const examenEfectivo = Math.max(nExamen, nMejora || 0);
      origen.textContent = (nMejora > nExamen) ? "Mejoramiento" : "Examen final";

      const comp70 = nLeccion*0.20 + examenEfectivo*0.50;
      const notaFinal = comp70 + comp30;

      resultado.textContent = notaFinal.toFixed(1);
      sub70.textContent = `${comp70.toFixed(1)} / 70`;
      sub30.textContent = `${comp30.toFixed(1)} / 30`;

      if (notaFinal >= 60){
        estado.textContent = "Aprobada";
        estado.className = "state ok";
        necesita.textContent = "";
      } else {
        estado.textContent = "Reprobada";
        estado.className = "state bad";

        // Calcular cuánto necesita en mejoramiento para aprobar
        const minNecesario = (60 - (nLeccion*0.20 + comp30)) / 0.50;
        if (minNecesario <= 100){
          necesita.textContent = `Necesitas al menos ${minNecesario.toFixed(1)} en el Mejoramiento para aprobar.`;
        } else {
          necesita.textContent = "Aunque saques 100 en el Mejoramiento, no alcanzarías 60.";
        }
      }
    }

    [leccion, examen, mejora, pruebas, controles, talleres, tareas].forEach(i=>{
      i.addEventListener("input", calcularNota);
    });
    $("calcular").addEventListener("click", calcularNota);

    $("toggleTheme").addEventListener("click", ()=>{
      document.body.classList.toggle("dark-mode");
      document.body.classList.toggle("light-mode");
      $("toggleTheme").textContent = document.body.classList.contains("dark-mode") ? "Modo claro" : "Modo oscuro";
    });

    calcularNota();
  </script>
</body>
</html>
